<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>test</title>
  <script src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js" type="text/javascript"></script>
  <style>
  	body {
  	}
  
  	#content { 
  		background-repeat:no-repeat; 
  	}
  	
  	.photo {
  		xbackground-color:#000;
  		float:left;
  		font-size:60%;
  	}  	
  	
	  	.photo img {
	  		display:block;
	  	}
	  	
	  	.photo .size {
	  		display:block;
	  	}
  </style>
<script>
$(document).ready(function() {
	var photoUrl = function(photo, size) {
		if (size == 0) size = ""; 
		
		size = size.toLowerCase();
		
		var sizes = {"square":"_s",
			"thumbnail":"_t",
			"small":"_m",
			"medium":""
		}
		
		var b = ["http://farm", photo.farm, ".static.flickr.com/", 
			photo.server, "/", photo.id, "_", photo.secret, sizes[size], ".jpg"]
		return b.join("");
	}

	var search = function() {
		$.getJSON(
			"http://api.flickr.com/services/rest/?jsoncallback=?",
			{ method : "flickr.photos.search",
				api_key : "b89c532ba8e26c1150bbdc2f0bc1f717",
				format : "json",
				//sort: "relevance",
				text : $("#search").val(),
				per_page: 1,
				page: 1
			},
			function(data) {
				$("#content").empty();
				$.each(data.photos.photo, function() {
					var photo = this;
						
					$("#content").append(
						$("<div>")
							.addClass("photo")
							.attr("id", photo.id)
							.append(
								$("<img>")
								.attr("src", photoUrl(photo, "square"))
								// When img is loaded, get the size
								.load(function() {
									$.getJSON("http://api.flickr.com/services/rest/?jsoncallback=?",
										{ method : "flickr.photos.getSizes",
											api_key : "b89c532ba8e26c1150bbdc2f0bc1f717",
											format : "json",
											photo_id: photo.id
										},
										function(data) {
											$.each(data.sizes.size, function() {
												$("#"+photo.id)
													.append(
														$("<a>")
															.addClass("size")
															.attr("href", photoUrl(photo, this.label))
															.text([this.height, this.width].join("x"))
													)
											})
										}
									)
								})
							)
							.append(
								$("<a>").text("link")
									.addClass("link")
									.attr("href", "http://www.flickr.com/photos/"+this.owner+"/"+this.id)
									.attr("target", "_blank")
							)							
					);
				});
			}
		);
	}
	
	$("#search").keypress(function(e) {
		if (e.which == 13) search();
	});
	
	search();
});
</script>
</head>
<body>
	<input id="search" value="volleyball" />
	<div id="content">		
	</div>
</body>
</html>
